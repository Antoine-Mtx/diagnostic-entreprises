<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnostic de l'entreprise</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>

<div class="container">
    <h1 class="mt-4 mb-4">Diagnostic pour l'entreprise : {{ enterprise.name }}</h1>
    {% for axis in axes %}
        <div class="axis mb-5">
            <h2 class="h4 mb-3">{{ axis.name }}</h2>
            <div id="chart-{{ axis.id }}"></div>
            <script>
                // Préparer les données pour le graphique radar
                var categories = {{ axis.categories|tojson }};
                var evaluationQuestions = {{ evaluation.questions|tojson }};
                var data = [{
                    type: 'scatterpolar',
                    r: [],
                    theta: [],
                    fill: 'toself'
                }];

                // Calculer les scores moyens pour chaque catégorie
                for (var i = 0; i < categories.length; i++) {
                    var categoryId = categories[i].id;
                    var totalScore = 0;
                    var questionCount = 0;

                    for (var j = 0; j < evaluationQuestions.length; j++) {
                        if (evaluationQuestions[j].category_id === categoryId) {
                            totalScore += evaluationQuestions[j].choice;
                            questionCount++;
                        }
                    }

                    var averageScore = totalScore / questionCount;
                    var scaledScore = averageScore * 5 / 2; // Mise à l'échelle du score entre 0 et 5

                    data[0].r.push(scaledScore);
                    data[0].theta.push(categories[i].name);
                }

                // Configurer le graphique radar
                var layout = {
                    title: '{{ axis.name }}',
                    polar: {
                        radialaxis: {
                            visible: true,
                            range: [0, 5]
                        }
                    },
                    showlegend: false
                };

                // Créer le graphique radar
                Plotly.newPlot('chart-{{ axis.id }}', data, layout);
            </script>
        </div>
    {% endfor %}
</div>

</body>
</html>
